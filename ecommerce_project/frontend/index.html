<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>E-Commerce App</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body>
<div class="container">
  <h1 class="my-4">Product List</h1>
  <div id="productList" class="mb-4"></div>
  <h2>Shopping Cart</h2>
  <div id="cartList"></div>
  <h3>Total: $<span id="total">0</span></h3>
  <button onclick="checkout()" class="btn btn-success">Checkout</button>
</div>

<script>
let cart = [];

function fetchProducts() {
  fetch("http://localhost:5000/api/products")
    .then(res => res.json())
    .then(products => {
      const list = document.getElementById("productList");
      list.innerHTML = "";
      products.forEach(product => {
        const div = document.createElement("div");
        div.innerHTML = `
          <strong>${product.name}</strong> - $${product.price}
          <button onclick='addToCart(${JSON.stringify(product)})' class='btn btn-sm btn-primary ml-2'>Add</button>
        `;
        list.appendChild(div);
      });
    });
}

function addToCart(product) {
  fetch("http://localhost:5000/api/cart", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(product)
  }).then(() => fetchCart());
}

function fetchCart() {
  fetch("http://localhost:5000/api/cart")
    .then(res => res.json())
    .then(items => {
      cart = items;
      const cartList = document.getElementById("cartList");
      cartList.innerHTML = "";
      let total = 0;
      items.forEach(item => {
        total += item.price;
        const div = document.createElement("div");
        div.innerHTML = `
          ${item.name} - $${item.price}
          <button onclick='removeFromCart(${item.id})' class='btn btn-sm btn-danger ml-2'>Remove</button>
        `;
        cartList.appendChild(div);
      });
      document.getElementById("total").textContent = total;
    });
}

function removeFromCart(id) {
  fetch("http://localhost:5000/api/cart/" + id, { method: "DELETE" })
    .then(() => fetchCart());
}

function checkout() {
  const total = cart.reduce((sum, item) => sum + item.price, 0);
  fetch("http://localhost:5000/api/checkout", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ cart, total })
  })
    .then(res => res.json())
    .then(data => {
      alert("Order placed! ID: " + data.orderId);
      cart = [];
      fetchCart();
    });
}

fetchProducts();
fetchCart();
</script>
</body>
</html>
